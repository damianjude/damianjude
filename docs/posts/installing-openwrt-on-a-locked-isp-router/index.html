<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Trying to Install OpenWrt on My ISP’s Locked-Down WiFi Router | damianjude</title><meta name=keywords content="router,openwrt,embedded-systems,reverse-engineering"><meta name=description content="

  UART output of the router booting

Recently, I&rsquo;ve been getting more into reverse-engineering, especially into embedded systems. So I decided to make my ISP&rsquo;s WiFi router (which I won&rsquo;t be naming for obvious reasons) the subject. I am a strong proponent of free software, and decided that it&rsquo;s time I break free of the locked-down firmware imposed by my ISP. My original goal was to replace the OS on it with OpenWrt."><meta name=author content="damianjude"><link rel=canonical href=https://damianjude.github.io/damianjude/posts/installing-openwrt-on-a-locked-isp-router/><link crossorigin=anonymous href=/damianjude/assets/css/stylesheet.da3211e5ef867bf2b75fd5a6515cfed7195c011e8ab735694e203810a827097b.css integrity="sha256-2jIR5e+Ge/K3X9WmUVz+1xlcAR6KtzVpTiA4EKgnCXs=" rel="preload stylesheet" as=style><link rel=icon href=https://damianjude.github.io/damianjude/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://damianjude.github.io/damianjude/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://damianjude.github.io/damianjude/favicon-32x32.png><link rel=apple-touch-icon href=https://damianjude.github.io/damianjude/apple-touch-icon.png><link rel=mask-icon href=https://damianjude.github.io/damianjude/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://damianjude.github.io/damianjude/posts/installing-openwrt-on-a-locked-isp-router/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="https://damianjude.github.io/damianjude/posts/installing-openwrt-on-a-locked-isp-router/"><meta property="og:site_name" content="damianjude"><meta property="og:title" content="Trying to Install OpenWrt on My ISP’s Locked-Down WiFi Router"><meta property="og:description" content="
UART output of the router booting Recently, I’ve been getting more into reverse-engineering, especially into embedded systems. So I decided to make my ISP’s WiFi router (which I won’t be naming for obvious reasons) the subject. I am a strong proponent of free software, and decided that it’s time I break free of the locked-down firmware imposed by my ISP. My original goal was to replace the OS on it with OpenWrt."><meta property="og:locale" content="en-uk"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2026-01-12T00:00:00+00:00"><meta property="article:modified_time" content="2026-01-12T00:00:00+00:00"><meta property="article:tag" content="Router"><meta property="article:tag" content="Openwrt"><meta property="article:tag" content="Embedded-Systems"><meta property="article:tag" content="Reverse-Engineering"><meta property="og:image" content="https://damianjude.github.io/damianjude/0007.avif"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://damianjude.github.io/damianjude/0007.avif"><meta name=twitter:title content="Trying to Install OpenWrt on My ISP’s Locked-Down WiFi Router"><meta name=twitter:description content="

  UART output of the router booting

Recently, I&rsquo;ve been getting more into reverse-engineering, especially into embedded systems. So I decided to make my ISP&rsquo;s WiFi router (which I won&rsquo;t be naming for obvious reasons) the subject. I am a strong proponent of free software, and decided that it&rsquo;s time I break free of the locked-down firmware imposed by my ISP. My original goal was to replace the OS on it with OpenWrt."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://damianjude.github.io/damianjude/posts/"},{"@type":"ListItem","position":2,"name":"Trying to Install OpenWrt on My ISP’s Locked-Down WiFi Router","item":"https://damianjude.github.io/damianjude/posts/installing-openwrt-on-a-locked-isp-router/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Trying to Install OpenWrt on My ISP’s Locked-Down WiFi Router","name":"Trying to Install OpenWrt on My ISP’s Locked-Down WiFi Router","description":"\nUART output of the router booting Recently, I\u0026rsquo;ve been getting more into reverse-engineering, especially into embedded systems. So I decided to make my ISP\u0026rsquo;s WiFi router (which I won\u0026rsquo;t be naming for obvious reasons) the subject. I am a strong proponent of free software, and decided that it\u0026rsquo;s time I break free of the locked-down firmware imposed by my ISP. My original goal was to replace the OS on it with OpenWrt.\n","keywords":["router","openwrt","embedded-systems","reverse-engineering"],"articleBody":"\nUART output of the router booting Recently, I’ve been getting more into reverse-engineering, especially into embedded systems. So I decided to make my ISP’s WiFi router (which I won’t be naming for obvious reasons) the subject. I am a strong proponent of free software, and decided that it’s time I break free of the locked-down firmware imposed by my ISP. My original goal was to replace the OS on it with OpenWrt.\nHardware Reconnaissance \u0026 Platform Analysis As always, the first step is reconnaissance; I had to understand the platform. A physical teardown of the router shows that it has a MediaTek MTK7986 (Filogic 830) SoC, whose reference boards are compatible with OpenWrt 24.10.x, so I downloaded the OpenWrt initramfs-kernel image.\nTeardown of the router (front and back) Firmware Lockdown \u0026 Configuration Backup Encryption However, the web dashboard doesn’t accept any firmware that isn’t signed by the ISP. So I had to find a workaround. While exploring the web dashboard, I noticed I could download the backup file which is in the form of a .tar.gz. Attempting to extract it with tar -xzvf failed. A hexdump -C -n 16 of the backup file showed 53 61 6c 74 65 64 5f 5f (corresponding to “Salted__”) indicating it has been OpenSSL encrypted using the password-based enc format. To understand how the backup was encrypted, I downloaded the router’s firmware image and used QEMU AArch64 static chroot. Running strings on ccrypt, which is the binary used for encryption, followed by strace showed that the command was openssl enc -pbkdf2 -in encryptedfile -out decryptedfile -d -aes256 -k \"/etc/server.key\". (Yes, using -k instead of -kfile, meaning the literal string \"/etc/server.key\" is used as a password and expanded via PBKDF2 rather than reading key material from the file.)\nGaining Root Access via Encrypted Backup Tampering It turns out that the backup file was a snapshot of the /etc/ directory. I had to modify the shadow, mwan3.user and dualwan files to set my own root password that allows me to dropbear SSH into a BusyBox shell. I realised that even the ISP uses a snapshot of OpenWrt 21.02, which is good, considering ISPs predominantly use proprietary buildroots, but that means the ISP had effectively frozen the system on an older release with unpatched vulnerabilities.\nUART Access \u0026 Vendor-Modified U-Boot\nEarlier, I had already soldered headers onto the router’s UART. Using a CP2102 USB-to-TTL adapter and tio, I gained access to the router’s serial debug interface which prompted for the username and password for access to U-Boot. Implying that this is a vendor-modified U-Boot build, as stock U-Boot does not implement authentication.\nSoldering headers on the router’s UART port (front and back) Boot Process, Watchdogs \u0026 NAND Layout Looking through the UART output, I noticed many peculiar things about this router. There are two watchdogs, one runs early:\nNOTICE: WDT: Cold boot NOTICE: WDT: disabled This is the SoC hardware watchdog which is enabled by the boot ROM and then disabled by BL2 during early boot to prevent resets during long DRAM and NAND initialisation.\nA Linux watchdog also exists that is serviced by procd which resets the router if userland or kernel hangs for 31s, i.e. stops making forward progress.\nmtk-wdt 1001c000.watchdog: Watchdog enabled (timeout=31 sec, nowayout=0) init: - watchdog - procd: - watchdog - There are also 8 partitions on the NAND:\n[ 1.359897] 8 fixed-partitions partitions found on MTD device nmbm_spim_nand [ 1.366942] Creating 8 MTD partitions on \"nmbm_spim_nand\": [ 1.372424] 0x000000000000-0x000000100000 : \"BL2\" [ 1.377649] 0x000000100000-0x000000180000 : \"u-boot-env\" [ 1.383326] 0x000000180000-0x000000380000 : \"Factory\" [ 1.388757] 0x000000380000-0x000000580000 : \"FIP\" [ 1.393853] 0x000000580000-0x000009180000 : \"ubi\" [ 1.399189] 0x000009180000-0x00000eb80000 : \"ubi2\" [ 1.404542] 0x00000eb80000-0x00000ed80000 : \"mfg\" [ 1.409629] 0x00000ed80000-0x00000ef80000 : \"-Reserved\" Multiple random MAC addresses are also being generated intentionally. It implies that either the factory MAC is missing, or is being suppressed by ISP firmware (MACs have been replaced with 00:1A:2B:3C:4D:5E):\n[ 0.999856] mtk_soc_eth 15100000.ethernet: generated random MAC address 00:1A:2B:3C:4D:5E ... [ 1.017862] mtk_soc_eth 15100000.ethernet: generated random MAC address 00:1A:2B:3C:4D:5E ... Warning: ethernet@15100000 (eth0) using random MAC address - 00:1A:2B:3C:4D:5E The WiFi firmware is also separate and vendor-opaque, the main CPU does not fully control radio behaviour and DFS is hard-coded here, so even if I did change it to OpenWrt that limits me to how far I can mod WiFi behaviour w/o signed blobs.\n[ 8.983061] platform 15010000.wed: WO Firmware Version: DEV_000000, Build Time: 20231228200534 ... [ 11.626474] mt7986-wmac 18000000.wbsys: WM Firmware Version: ____000000, Build Time: 20240325151449 ... [ 11.709017] mt7986-wmac 18000000.wbsys: WA Firmware Version: DEV_000000, Build Time: 20231228200519 There was also a debug level selector:\nPress the [1], [2], [3] or [4] key and hit [enter] to select the debug level All of this suggests that it is far from a vanilla OpenWrt build.\nWhile exploring the filesystem, a script named etc/mfg/gm_mtc/gm_factory_init.sh stood out and that contained the logic that generates the router’s U-Boot credentials, which by the way, is unique for each router. After rebooting, interrupting autoboot at the right moment, and authenticating, I finally reached the MT7986\u003e U-Boot prompt.\nThe router has 512 MB of RAM and 256 MB of NAND flash. Pretty substantial for a router that at maximum handles about 20 devices.\nSecure Boot Enforcement \u0026 FIT Signature Verification Using loady, I transferred the OpenWrt initramfs-kernel (~8 MB) into 0x48000000 memory, which took ~12 minutes (expected for YMODEM at 115200 baud), and attempted to boot it with bootm 0x48000000 but it failed with Failed to verify required signature Bad Data Hash error. Implying that U-Boot enforces mandatory FIT signature verification, with the public key compiled into the bootloader. The legacy verify=yes/no mechanism does not exist.\nI decided to take an alternative approach with booti 0x48000000 - 0x5f7fd620 which failed with Bad Linux ARM64 Image magic!. That’s weird, so I iminfoed and found that it’s actually an FIT which is LZMA compressed. After manually extracting with imxtract, cp.b and lzmadec later, I bootied again with the memory addresses of each, kernel, initramfs and DTB. However, despite multiple attempts, the kernel never presented a valid ARM64 Image header magic: 0x644d5241 (ARMd). It turns out the ISP-modified U-Boot does not provide a path to extract and boot FIT-integrated kernels correctly.\nExamining the full uninterrupted UART output shows that the router is pretty robust and secure for consumer equipment. The root of trust begins in the immutable ROM which loads and verifies BL2. The BL2 here uses mbed TLS for later stage verification. BL2 enforces rollback protection, and loads a RSA2048 (key embedded upstream in the boot chain) verified U-Boot, which in turn, enforces the FIT signature for OpenWrt.\nBoot chain:\nROM → BL2 (signed, rollback-protected) → U-Boot (signed) → Linux (signed FIT only) → SquashFS (immutable) → Overlay (disposable) Immutable Filesystem \u0026 A/B Firmware Redundancy Also, the router uses an A/B firmware layout, that is, two separate firmware copies are maintained for redundancy, making it nearly impossible to brick the device by normal failures such as firmware updates, power loss or resetting the device.\nI confirmed the immutable SquashFS by SSHing and running the age-old “delete System32” of Linux devices, sudo rm -rf /. BusyBox processed it and deleted the writable overlay since the root filesystem itself is immutable SquashFS. I was left with a non-working system (evidenced by the inode failures). After a reboot, the router was up and running. It did recover, and the router performed a factory reset, evidenced by the loss of my SSH and custom root password.\nSecurity Architecture Summary This makes my router effectively unbrickable. I would have to break at least three independent measures:\nSecure boot chain (ROM, BL2, U-Boot) NMBM metadata A/B firmware redundancy Lessons Learned At this point, I had reached a dead end. Flashing the NAND directly using an SPI programmer would not help for unsigned firmware, as the ROM will only execute a signed BL2 (NAND is not encrypted). The only way forward would be to find a SoC-specific exploit or hardware fault injection, both of which are well beyond the scope of this project. Bypassing secure boot would shift the project from firmware RE to hardware security research.\nWhile I didn’t achieve my original goal of running OpenWrt, this project was far from a failure. It was a valuable learning experience, especially as a first exposure to embedded systems, low-level firmware, and hands-on hardware work such as soldering. It was well worth the Rs. 800 I spent on tools for this. I did learn about ARM architecture, Trusted boot chains and MediaTek’s secure boot design, FIT images, DTBs, and initramfs handling, U-Boot and UART.\nTools and setup used for the project Overall, despite its ups and downs, this was a valuable learning experience, and one that I’ll carry forward into future projects.\n","wordCount":"1452","inLanguage":"en","image":"https://damianjude.github.io/damianjude/0007.avif","datePublished":"2026-01-12T00:00:00Z","dateModified":"2026-01-12T00:00:00Z","author":{"@type":"Person","name":"damianjude"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://damianjude.github.io/damianjude/posts/installing-openwrt-on-a-locked-isp-router/"},"publisher":{"@type":"Organization","name":"damianjude","logo":{"@type":"ImageObject","url":"https://damianjude.github.io/damianjude/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://damianjude.github.io/damianjude/ accesskey=h title="damianjude (Alt + H)">damianjude</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://damianjude.github.io/damianjude/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://damianjude.github.io/damianjude/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://damianjude.github.io/damianjude/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://damianjude.github.io/damianjude/>Home</a>&nbsp;»&nbsp;<a href=https://damianjude.github.io/damianjude/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Trying to Install OpenWrt on My ISP’s Locked-Down WiFi Router</h1><div class=post-meta><span title='2026-01-12 00:00:00 +0000 UTC'>January 12, 2026</span>&nbsp;·&nbsp;<span>7 min</span>&nbsp;·&nbsp;<span>damianjude</span></div></header><div class=post-content><p><img alt="UART output of the router booting" loading=lazy src=/damianjude/posts/installing-openwrt-on-a-locked-isp-router/0006.avif></p><p style=text-align:center>UART output of the router booting</p><p>Recently, I&rsquo;ve been getting more into reverse-engineering, especially into embedded systems. So I decided to make my ISP&rsquo;s WiFi router (which I won&rsquo;t be naming for obvious reasons) the subject. I am a strong proponent of free software, and decided that it&rsquo;s time I break free of the locked-down firmware imposed by my ISP. My original goal was to replace the OS on it with OpenWrt.</p><h2 id=hardware-reconnaissance--platform-analysis>Hardware Reconnaissance & Platform Analysis<a hidden class=anchor aria-hidden=true href=#hardware-reconnaissance--platform-analysis>#</a></h2><p>As always, the first step is reconnaissance; I had to understand the platform. A physical teardown of the router shows that it has a MediaTek MTK7986 (Filogic 830) SoC, whose reference boards are compatible with OpenWrt 24.10.x, so I downloaded the OpenWrt initramfs-kernel image.</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><img loading=lazy src=/damianjude/posts/installing-openwrt-on-a-locked-isp-router/0001.avif></td><td><img loading=lazy src=/damianjude/posts/installing-openwrt-on-a-locked-isp-router/0002.avif></td></tr></tbody></table><p style=text-align:center>Teardown of the router (front and back)</p><h2 id=firmware-lockdown--configuration-backup-encryption>Firmware Lockdown & Configuration Backup Encryption<a hidden class=anchor aria-hidden=true href=#firmware-lockdown--configuration-backup-encryption>#</a></h2><p>However, the web dashboard doesn&rsquo;t accept any firmware that isn&rsquo;t signed by the ISP. So I had to find a workaround. While exploring the web dashboard, I noticed I could download the backup file which is in the form of a <code>.tar.gz</code>. Attempting to extract it with <code>tar -xzvf</code> failed. A <code>hexdump -C -n 16</code> of the backup file showed <code>53 61 6c 74 65 64 5f 5f</code> (corresponding to &ldquo;Salted__&rdquo;) indicating it has been OpenSSL encrypted using the password-based <code>enc</code> format. To understand how the backup was encrypted, I downloaded the router&rsquo;s firmware image and used QEMU AArch64 static chroot. Running <code>strings</code> on <code>ccrypt</code>, which is the binary used for encryption, followed by <code>strace</code> showed that the command was <code>openssl enc -pbkdf2 -in encryptedfile -out decryptedfile -d -aes256 -k "/etc/server.key"</code>. (Yes, using <code>-k</code> instead of <code>-kfile</code>, meaning the literal string <code>"/etc/server.key"</code> is used as a password and expanded via PBKDF2 rather than reading key material from the file.)</p><h2 id=gaining-root-access-via-encrypted-backup-tampering>Gaining Root Access via Encrypted Backup Tampering<a hidden class=anchor aria-hidden=true href=#gaining-root-access-via-encrypted-backup-tampering>#</a></h2><p>It turns out that the backup file was a snapshot of the <code>/etc/</code> directory. I had to modify the <code>shadow</code>, <code>mwan3.user</code> and <code>dualwan</code> files to set my own root password that allows me to <code>dropbear</code> SSH into a <code>BusyBox</code> shell. I realised that even the ISP uses a snapshot of OpenWrt 21.02, which is good, considering ISPs predominantly use proprietary buildroots, but that means the ISP had effectively frozen the system on an older release with unpatched vulnerabilities.</p><p>UART Access & Vendor-Modified U-Boot</p><p>Earlier, I had already soldered headers onto the router&rsquo;s UART. Using a CP2102 USB-to-TTL adapter and <code>tio</code>, I gained access to the router&rsquo;s serial debug interface which prompted for the username and password for access to U-Boot. Implying that this is a vendor-modified U-Boot build, as stock U-Boot does not implement authentication.</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><img loading=lazy src=/damianjude/posts/installing-openwrt-on-a-locked-isp-router/0003.avif></td><td><img loading=lazy src=/damianjude/posts/installing-openwrt-on-a-locked-isp-router/0004.avif></td></tr></tbody></table><p style=text-align:center>Soldering headers on the router’s UART port (front and back)</p><h2 id=boot-process-watchdogs--nand-layout>Boot Process, Watchdogs & NAND Layout<a hidden class=anchor aria-hidden=true href=#boot-process-watchdogs--nand-layout>#</a></h2><p>Looking through the UART output, I noticed many peculiar things about this router. There are two watchdogs, one runs early:</p><pre tabindex=0><code>NOTICE: WDT: Cold boot
NOTICE: WDT: disabled
</code></pre><p>This is the SoC hardware watchdog which is enabled by the boot ROM and then disabled by BL2 during early boot to prevent resets during long DRAM and NAND initialisation.</p><p>A Linux watchdog also exists that is serviced by <code>procd</code> which resets the router if userland or kernel hangs for 31s, i.e. stops making forward progress.</p><pre tabindex=0><code>mtk-wdt 1001c000.watchdog: Watchdog enabled (timeout=31 sec, nowayout=0)
init: - watchdog -
procd: - watchdog -
</code></pre><p>There are also 8 partitions on the NAND:</p><pre tabindex=0><code>[    1.359897] 8 fixed-partitions partitions found on MTD device nmbm_spim_nand
[    1.366942] Creating 8 MTD partitions on &#34;nmbm_spim_nand&#34;:
[    1.372424] 0x000000000000-0x000000100000 : &#34;BL2&#34;
[    1.377649] 0x000000100000-0x000000180000 : &#34;u-boot-env&#34;
[    1.383326] 0x000000180000-0x000000380000 : &#34;Factory&#34;
[    1.388757] 0x000000380000-0x000000580000 : &#34;FIP&#34;
[    1.393853] 0x000000580000-0x000009180000 : &#34;ubi&#34;
[    1.399189] 0x000009180000-0x00000eb80000 : &#34;ubi2&#34;
[    1.404542] 0x00000eb80000-0x00000ed80000 : &#34;mfg&#34;
[    1.409629] 0x00000ed80000-0x00000ef80000 : &#34;&lt;ISPname&gt;-Reserved&#34;
</code></pre><p>Multiple random MAC addresses are also being generated intentionally. It implies that either the factory MAC is missing, or is being suppressed by ISP firmware (MACs have been replaced with <code>00:1A:2B:3C:4D:5E</code>):</p><pre tabindex=0><code>[    0.999856] mtk_soc_eth 15100000.ethernet: generated random MAC address 00:1A:2B:3C:4D:5E
...
[    1.017862] mtk_soc_eth 15100000.ethernet: generated random MAC address 00:1A:2B:3C:4D:5E
...
Warning: ethernet@15100000 (eth0) using random MAC address - 00:1A:2B:3C:4D:5E
</code></pre><p>The WiFi firmware is also separate and vendor-opaque, the main CPU does not fully control radio behaviour and DFS is hard-coded here, so even if I did change it to OpenWrt that limits me to how far I can mod WiFi behaviour w/o signed blobs.</p><pre tabindex=0><code>[    8.983061] platform 15010000.wed: WO Firmware Version: DEV_000000, Build Time: 20231228200534
...
[   11.626474] mt7986-wmac 18000000.wbsys: WM Firmware Version: ____000000, Build Time: 20240325151449
...
[   11.709017] mt7986-wmac 18000000.wbsys: WA Firmware Version: DEV_000000, Build Time: 20231228200519
</code></pre><p>There was also a debug level selector:</p><pre tabindex=0><code>Press the [1], [2], [3] or [4] key and hit [enter] to select the debug level
</code></pre><p>All of this suggests that it is far from a vanilla OpenWrt build.</p><p>While exploring the filesystem, a script named <code>etc/mfg/gm_mtc/gm_factory_init.sh</code> stood out and that contained the logic that generates the router&rsquo;s U-Boot credentials, which by the way, is unique for each router. After rebooting, interrupting autoboot at the right moment, and authenticating, I finally reached the <code>MT7986></code> U-Boot prompt.</p><p>The router has 512 MB of RAM and 256 MB of NAND flash. Pretty substantial for a router that at maximum handles about 20 devices.</p><h2 id=secure-boot-enforcement--fit-signature-verification>Secure Boot Enforcement & FIT Signature Verification<a hidden class=anchor aria-hidden=true href=#secure-boot-enforcement--fit-signature-verification>#</a></h2><p>Using <code>loady</code>, I transferred the OpenWrt initramfs-kernel (~8 MB) into <code>0x48000000</code> memory, which took ~12 minutes (expected for YMODEM at 115200 baud), and attempted to boot it with <code>bootm 0x48000000</code> but it failed with <code>Failed to verify required signature Bad Data Hash</code> error. Implying that U-Boot enforces mandatory FIT signature verification, with the public key compiled into the bootloader. The legacy <code>verify=yes/no</code> mechanism does not exist.</p><p>I decided to take an alternative approach with <code>booti 0x48000000 - 0x5f7fd620</code> which failed with <code>Bad Linux ARM64 Image magic!</code>. That&rsquo;s weird, so I <code>iminfo</code>ed and found that it&rsquo;s actually an FIT which is LZMA compressed. After manually extracting with <code>imxtract</code>, <code>cp.b</code> and <code>lzmadec</code> later, I <code>booti</code>ed again with the memory addresses of each, kernel, initramfs and DTB. However, despite multiple attempts, the kernel never presented a valid ARM64 Image header magic: <code>0x644d5241</code> (<code>ARMd</code>). It turns out the ISP-modified U-Boot does not provide a path to extract and boot FIT-integrated kernels correctly.</p><p>Examining the full uninterrupted UART output shows that the router is pretty robust and secure for consumer equipment. The root of trust begins in the immutable ROM which loads and verifies BL2. The BL2 here uses <code>mbed TLS</code> for later stage verification. BL2 enforces rollback protection, and loads a RSA2048 (key embedded upstream in the boot chain) verified U-Boot, which in turn, enforces the FIT signature for OpenWrt.</p><p>Boot chain:</p><pre tabindex=0><code>ROM → BL2 (signed, rollback-protected) → U-Boot (signed) → Linux (signed FIT only) → SquashFS (immutable) → Overlay (disposable)
</code></pre><h2 id=immutable-filesystem--ab-firmware-redundancy>Immutable Filesystem & A/B Firmware Redundancy<a hidden class=anchor aria-hidden=true href=#immutable-filesystem--ab-firmware-redundancy>#</a></h2><p>Also, the router uses an A/B firmware layout, that is, two separate firmware copies are maintained for redundancy, making it nearly impossible to brick the device by normal failures such as firmware updates, power loss or resetting the device.</p><p>I confirmed the immutable SquashFS by <code>SSH</code>ing and running the age-old &ldquo;delete System32&rdquo; of Linux devices, <code>sudo rm -rf /</code>. <code>BusyBox</code> processed it and deleted the writable overlay since the root filesystem itself is immutable SquashFS. I was left with a non-working system (evidenced by the <code>inode</code> failures). After a reboot, the router was up and running. It did recover, and the router performed a factory reset, evidenced by the loss of my <code>SSH</code> and custom root password.</p><h2 id=security-architecture-summary>Security Architecture Summary<a hidden class=anchor aria-hidden=true href=#security-architecture-summary>#</a></h2><p>This makes my router effectively unbrickable. I would have to break at least three independent measures:</p><ol><li>Secure boot chain (ROM, BL2, U-Boot)</li><li>NMBM metadata</li><li>A/B firmware redundancy</li></ol><h2 id=lessons-learned>Lessons Learned<a hidden class=anchor aria-hidden=true href=#lessons-learned>#</a></h2><p>At this point, I had reached a dead end. Flashing the NAND directly using an SPI programmer would not help for unsigned firmware, as the ROM will only execute a signed BL2 (NAND is not encrypted). The only way forward would be to find a SoC-specific exploit or hardware fault injection, both of which are well beyond the scope of this project. Bypassing secure boot would shift the project from firmware RE to hardware security research.</p><p>While I didn’t achieve my original goal of running OpenWrt, this project was far from a failure. It was a valuable learning experience, especially as a first exposure to embedded systems, low-level firmware, and hands-on hardware work such as soldering. It was well worth the Rs. 800 I spent on tools for this. I did learn about ARM architecture, Trusted boot chains and MediaTek’s secure boot design, FIT images, DTBs, and initramfs handling, U-Boot and UART.</p><p><img alt="UART header close-up" loading=lazy src=/damianjude/posts/installing-openwrt-on-a-locked-isp-router/0005.avif></p><p style=text-align:center>Tools and setup used for the project</p><p>Overall, despite its ups and downs, this was a valuable learning experience, and one that I’ll carry forward into future projects.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://damianjude.github.io/damianjude/tags/router/>Router</a></li><li><a href=https://damianjude.github.io/damianjude/tags/openwrt/>Openwrt</a></li><li><a href=https://damianjude.github.io/damianjude/tags/embedded-systems/>Embedded-Systems</a></li><li><a href=https://damianjude.github.io/damianjude/tags/reverse-engineering/>Reverse-Engineering</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://damianjude.github.io/damianjude/>damianjude</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>